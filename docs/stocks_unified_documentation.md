# üìä Documenta√ß√£o da Tabela `stocks_unified`

## üéØ Vis√£o Geral

A tabela `stocks_unified` √© uma base de dados consolidada contendo informa√ß√µes abrangentes sobre a√ß√µes americanas, resultado da fus√£o otimizada das tabelas `assets_master`, `stock_metrics_snapshot` e `stock_prices_daily`. Esta documenta√ß√£o detalha todos os campos, tipos de dados e metodologias de captura utilizadas.

## üìÖ Hist√≥rico de Cria√ß√£o

- **Data de Cria√ß√£o**: Janeiro 2025
- **Migra√ß√£o Conclu√≠da**: Janeiro 2025
- **√öltima Atualiza√ß√£o Massiva**: Janeiro 2025 (393 a√ß√µes processadas)
- **Total de Registros**: 1.385 a√ß√µes americanas ativas

## üìã Estrutura Detalhada da Tabela

### üîë **IDENTIFICA√á√ÉO**

| Campo | Tipo | Descri√ß√£o | Fonte de Captura | Completude |
|-------|------|-----------|------------------|------------|
| `id` | `BIGSERIAL PRIMARY KEY` | Identificador √∫nico sequencial | Auto-gerado pelo PostgreSQL | 100% |
| `ticker` | `TEXT NOT NULL UNIQUE` | S√≠mbolo da a√ß√£o (ex: AAPL, MSFT) | APIs financeiras, bases de dados originais | 100% |
| `name` | `TEXT NOT NULL` | Nome completo da empresa | APIs financeiras, bases de dados originais | 100% |

### üè≠ **CLASSIFICA√á√ÉO**

| Campo | Tipo | Descri√ß√£o | Fonte de Captura | Completude |
|-------|------|-----------|------------------|------------|
| `sector` | `TEXT` | Setor econ√¥mico (ex: Technology, Healthcare) | APIs financeiras, classifica√ß√£o GICS | ~95% |
| `industry` | `TEXT` | Ind√∫stria espec√≠fica (ex: Software, Pharmaceuticals) | APIs financeiras, classifica√ß√£o GICS | ~90% |
| `exchange` | `TEXT DEFAULT 'NASDAQ'` | Bolsa de valores onde a a√ß√£o √© negociada | APIs financeiras | ~85% |
| `currency` | `TEXT DEFAULT 'USD'` | Moeda de negocia√ß√£o | Padr√£o USD para a√ß√µes americanas | 100% |

### üè¢ **DADOS CORPORATIVOS**

| Campo | Tipo | Descri√ß√£o | Fonte de Captura | Completude |
|-------|------|-----------|------------------|------------|
| `business_description` | `TEXT` | Descri√ß√£o detalhada do neg√≥cio da empresa | yfinance.info, dados corporativos | ~60% |

### üí∞ **DADOS DE MERCADO ATUAIS**

| Campo | Tipo | Descri√ß√£o | Fonte de Captura | Completude |
|-------|------|-----------|------------------|------------|
| `current_price` | `NUMERIC` | Pre√ßo atual da a√ß√£o (USD) | yfinance, APIs de mercado em tempo real | ~85% |
| `market_cap` | `BIGINT` | Capitaliza√ß√£o de mercado (USD) | Calculado: current_price √ó shares_outstanding | ~80% |
| `shares_outstanding` | `BIGINT` | N√∫mero de a√ß√µes em circula√ß√£o | yfinance.info, relat√≥rios financeiros | ~75% |
| `volume_avg_30d` | `BIGINT` | Volume m√©dio de negocia√ß√£o dos √∫ltimos 30 dias | yfinance, dados hist√≥ricos de volume | ~70% |

### üìà **RETORNOS HIST√ìRICOS**

| Campo | Tipo | Descri√ß√£o | Fonte de Captura | Completude |
|-------|------|-----------|------------------|------------|
| `returns_12m` | `NUMERIC` | Retorno percentual dos √∫ltimos 12 meses | Calculado: (pre√ßo_atual - pre√ßo_12m_atr√°s) / pre√ßo_12m_atr√°s √ó 100 | ~85% |
| `returns_24m` | `NUMERIC` | Retorno percentual dos √∫ltimos 24 meses | Calculado com dados hist√≥ricos yfinance | ~75% |
| `returns_36m` | `NUMERIC` | Retorno percentual dos √∫ltimos 36 meses | Calculado com dados hist√≥ricos yfinance | ~70% |
| `returns_5y` | `NUMERIC` | Retorno percentual dos √∫ltimos 5 anos | Calculado com dados hist√≥ricos yfinance | ~65% |
| `ten_year_return` | `NUMERIC` | Retorno percentual dos √∫ltimos 10 anos | Calculado com dados hist√≥ricos yfinance | ~50% |

### ‚ö° **M√âTRICAS DE RISCO**

| Campo | Tipo | Descri√ß√£o | Fonte de Captura | Completude |
|-------|------|-----------|------------------|------------|
| `volatility_12m` | `NUMERIC` | Volatilidade (desvio padr√£o) dos √∫ltimos 12 meses | Calculado: std(retornos_di√°rios) √ó ‚àö252 | ~80% |
| `volatility_24m` | `NUMERIC` | Volatilidade dos √∫ltimos 24 meses | Calculado com dados hist√≥ricos | ~70% |
| `volatility_36m` | `NUMERIC` | Volatilidade dos √∫ltimos 36 meses | Calculado com dados hist√≥ricos | ~65% |
| `ten_year_volatility` | `NUMERIC` | Volatilidade dos √∫ltimos 10 anos | Calculado com dados hist√≥ricos | ~45% |
| `max_drawdown` | `NUMERIC` | Maior queda percentual do pico ao vale | Calculado: max((pico - vale) / pico) √ó 100 | ~75% |
| `sharpe_12m` | `NUMERIC` | √çndice Sharpe dos √∫ltimos 12 meses | Calculado: (retorno - taxa_livre_risco) / volatilidade | ~75% |
| `sharpe_24m` | `NUMERIC` | √çndice Sharpe dos √∫ltimos 24 meses | Calculado com dados hist√≥ricos | ~65% |
| `sharpe_36m` | `NUMERIC` | √çndice Sharpe dos √∫ltimos 36 meses | Calculado com dados hist√≥ricos | ~60% |
| `ten_year_sharpe` | `NUMERIC` | √çndice Sharpe dos √∫ltimos 10 anos | Calculado com dados hist√≥ricos | ~40% |
| `beta_coefficient` | `NUMERIC` | Coeficiente Beta vs S&P 500 | yfinance.info, calculado via regress√£o linear | ~60% |

### üíµ **DIVIDENDOS**

| Campo | Tipo | Descri√ß√£o | Fonte de Captura | Completude |
|-------|------|-----------|------------------|------------|
| `dividend_yield_12m` | `NUMERIC` | Dividend yield dos √∫ltimos 12 meses (%) | Calculado: dividendos_12m / pre√ßo_atual √ó 100 | ~70% |
| `dividends_12m` | `NUMERIC` | Total de dividendos pagos nos √∫ltimos 12 meses (USD) | yfinance.dividends, dados hist√≥ricos | ~65% |
| `dividends_24m` | `NUMERIC` | Total de dividendos pagos nos √∫ltimos 24 meses (USD) | yfinance.dividends, dados hist√≥ricos | ~60% |
| `dividends_36m` | `NUMERIC` | Total de dividendos pagos nos √∫ltimos 36 meses (USD) | yfinance.dividends, dados hist√≥ricos | ~55% |
| `dividends_all_time` | `NUMERIC` | Total de dividendos pagos historicamente (USD) | yfinance.dividends, dados hist√≥ricos completos | ~45% |

### üìä **M√âTRICAS FUNDAMENTAIS**

| Campo | Tipo | Descri√ß√£o | Fonte de Captura | Completude |
|-------|------|-----------|------------------|------------|
| `pe_ratio` | `NUMERIC` | Price-to-Earnings ratio | yfinance.info, Perplexity AI (2024/2025) | ~70% |
| `pb_ratio` | `NUMERIC` | Price-to-Book ratio | **Perplexity AI** - dados verificados 2024/2025 | **17.8%** |
| `ps_ratio` | `NUMERIC` | Price-to-Sales ratio | **Perplexity AI** - dados verificados 2024/2025 | **16.5%** |
| `peg_ratio` | `NUMERIC` | Price/Earnings-to-Growth ratio | yfinance.info, Perplexity AI | ~15% |
| `roe` | `NUMERIC` | Return on Equity (%) | yfinance.info, calculado: net_income / shareholders_equity √ó 100 | ~60% |
| `roa` | `NUMERIC` | Return on Assets (%) | **Perplexity AI** - dados verificados 2024/2025 | **18.5%** |
| `roi` | `NUMERIC` | Return on Investment (%) | **Calculado**: (net_income / total_assets) √ó 100 | **16.0%** |
| `profit_margin` | `NUMERIC` | Margem de lucro l√≠quido (%) | **Perplexity AI** - dados verificados 2024/2025 | **18.7%** |
| `debt_to_equity` | `NUMERIC` | Rela√ß√£o d√≠vida/patrim√¥nio | yfinance.info, calculado: total_debt / shareholders_equity | ~55% |
| `current_ratio` | `NUMERIC` | Liquidez corrente | **Perplexity AI** - dados verificados 2024/2025 | **17.2%** |
| `revenue` | `BIGINT` | Receita total anual (USD) | yfinance.financials, relat√≥rios anuais | ~65% |
| `net_income` | `BIGINT` | Lucro l√≠quido anual (USD) | **Perplexity AI** - dados verificados 2024/2025 | **18.1%** |
| `total_assets` | `BIGINT` | Total de ativos (USD) | **Perplexity AI** - dados verificados 2024/2025 | **16.0%** |
| `total_debt` | `BIGINT` | D√≠vida total (USD) | **Perplexity AI** - dados verificados 2024/2025 | **15.9%** |
| `free_cash_flow` | `BIGINT` | Fluxo de caixa livre (USD) | yfinance.cashflow, relat√≥rios financeiros | ~50% |
| `book_value` | `NUMERIC` | Valor patrimonial por a√ß√£o (USD) | yfinance.info, calculado: shareholders_equity / shares_outstanding | ~55% |
| `enterprise_value` | `BIGINT` | Valor da empresa (USD) | Calculado: market_cap + total_debt - cash | ~45% |
| `ebitda` | `BIGINT` | Earnings Before Interest, Taxes, Depreciation and Amortization (USD) | yfinance.financials, relat√≥rios financeiros | ~50% |

### ü§ñ **AN√ÅLISES DE IA**

| Campo | Tipo | Descri√ß√£o | Fonte de Captura | Completude |
|-------|------|-----------|------------------|------------|
| `ai_investment_thesis` | `TEXT` | Tese de investimento gerada por IA | Perplexity AI - an√°lises contextualizadas | ~8% |
| `ai_risk_analysis` | `TEXT` | An√°lise de riscos gerada por IA | Perplexity AI - an√°lises contextualizadas | ~8% |
| `ai_market_context` | `TEXT` | Contexto de mercado detalhado | **Perplexity AI** - **393 an√°lises detalhadas** | **14.9%** |
| `ai_use_cases` | `TEXT` | Casos de uso e aplica√ß√µes | Perplexity AI - an√°lises contextualizadas | ~8% |
| `ai_analysis_date` | `TIMESTAMPTZ` | Data da √∫ltima an√°lise de IA | Auto-gerado durante processamento Perplexity | **14.9%** |
| `ai_analysis_version` | `VARCHAR(50)` | Vers√£o da an√°lise de IA | Controle de vers√£o: "v2.0_mega_batch_400" | **14.9%** |

### üìÖ **CONTROLE E METADADOS**

| Campo | Tipo | Descri√ß√£o | Fonte de Captura | Completude |
|-------|------|-----------|------------------|------------|
| `last_updated` | `TIMESTAMPTZ DEFAULT NOW()` | √öltima atualiza√ß√£o do registro | Auto-gerado pelo sistema | 100% |
| `data_quality_score` | `INTEGER DEFAULT 0` | Score de qualidade dos dados (0-100) | Calculado baseado na completude dos campos | ~30% |
| `source_meta` | `JSONB` | Metadados das fontes de dados | Controle de auditoria das origens | ~60% |
| `fundamentals_source_meta` | `JSONB` | Metadados espec√≠ficos dos dados fundamentais | Controle de auditoria Perplexity AI | **16.0%** |
| `fundamentals_last_updated` | `TIMESTAMPTZ` | √öltima atualiza√ß√£o dos dados fundamentais | Auto-gerado durante processamento massivo | **16.0%** |

## üöÄ Metodologia de Captura de Dados

### üìä **Dados Hist√≥ricos e Calculados**

**Fonte Principal**: `yfinance` (Yahoo Finance API)
- **Retornos**: Calculados a partir de pre√ßos hist√≥ricos di√°rios
- **Volatilidade**: Desvio padr√£o anualizado dos retornos di√°rios
- **Sharpe Ratio**: (Retorno - Taxa Livre de Risco) / Volatilidade
- **Max Drawdown**: Maior queda do pico hist√≥rico ao vale
- **Dividendos**: Hist√≥rico completo de pagamentos

### ü§ñ **Enriquecimento via IA (Perplexity AI)**

**Opera√ß√£o Massiva Realizada**: Janeiro 2025
- **Total Processado**: 393 a√ß√µes de classe mundial
- **Grupos Processados**: 29 grupos mega
- **Taxa de Sucesso**: 100%
- **Estrat√©gia Final**: 35 a√ß√µes por lote (Ultimate Mega)

**Campos Enriquecidos via Perplexity AI**:
- `pb_ratio`, `ps_ratio`, `total_assets`, `total_debt`
- `net_income`, `roa`, `profit_margin`, `current_ratio`
- `ai_market_context` (an√°lises detalhadas de mercado)
- `roi` (calculado automaticamente)

**Prompt Utilizado**:
```
"Preciso de dados fundamentals para estas [N] GRANDES EMPRESAS AMERICANAS: [TICKERS].

Para cada a√ß√£o, busque VALORES NUM√âRICOS EXATOS de:
- P/B ratio, P/S ratio, Total Assets (USD), Total Debt (USD), 
- Net Income (USD), ROA (%), Profit Margin (%), Current Ratio

E an√°lise de mercado detalhada.

Use dados de 2024/2025."
```

### üìà **Dados de Mercado em Tempo Real**

**Fonte**: APIs financeiras diversas
- **Pre√ßos**: Atualizados via yfinance
- **Volume**: M√©dias m√≥veis de 30 dias
- **Market Cap**: Calculado em tempo real

### üè¢ **Dados Corporativos**

**Fontes**:
- `yfinance.info` (dados b√°sicos)
- Relat√≥rios financeiros oficiais
- Bases de dados corporativas

## üìä Status de Completude por Categoria

### üü¢ **Alta Completude (>70%)**
- **Identifica√ß√£o**: 100% (ticker, name)
- **Retornos 12m**: ~85%
- **Volatilidade 12m**: ~80%
- **Pre√ßos Atuais**: ~85%

### üü° **M√©dia Completude (30-70%)**
- **Dados Fundamentais B√°sicos**: ~60-70%
- **Dividendos**: ~65%
- **M√©tricas de Risco**: ~60-75%

### üî¥ **Baixa Completude (<30%)**
- **Dados Perplexity AI**: ~14.9-18.7% (393 a√ß√µes processadas)
- **Dados Hist√≥ricos Longos**: ~40-50%
- **An√°lises de IA Completas**: ~8%

## üéØ Conquistas da Opera√ß√£o Massiva

### üìà **Antes da Opera√ß√£o** (Janeiro 2025)
- Dados fundamentais: <5% de completude
- An√°lises de IA: 0%
- Dados verificados: M√≠nimos

### üöÄ **Ap√≥s Opera√ß√£o Massiva** (Janeiro 2025)
- **393 a√ß√µes processadas** com dados completos
- **6.288 campos fundamentais** preenchidos
- **393 an√°lises de IA** contextualizadas
- **17.8% completude em pb_ratio**
- **18.7% completude em profit_margin**
- **14.9% completude em ai_market_context**

## üèÜ Empresas Processadas - Destaques

### üí∞ **Top 10 por Lucro L√≠quido**
1. **Eli Lilly (LLY)**: US$ 12.9B - ROA 17.6%
2. **Coca-Cola (KO)**: US$ 10.7B - ROA 10.4%
3. **Linde (LIN)**: US$ 7.2B - 18.2% margem
4. **Lowe's (LOW)**: US$ 7.0B - ROA 14.6%
5. **Lockheed Martin (LMT)**: US$ 6.9B - ROA 11.0%

### ‚ö° **Top 10 por ROA**
1. **KLA Corporation (KLAC)**: 29.0% - 32.6% margem
2. **Lam Research (LRCX)**: 27.0% - 27.8% margem
3. **Lululemon (LULU)**: 19.0% - 16.4% margem
4. **Eli Lilly (LLY)**: 17.6%
5. **Lowe's (LOW)**: 14.6%

## üîß √çndices e Constraints

```sql
-- √çndices para Performance
CREATE INDEX idx_stocks_ticker ON stocks_unified(ticker);
CREATE INDEX idx_stocks_sector ON stocks_unified(sector);
CREATE INDEX idx_stocks_market_cap ON stocks_unified(market_cap DESC);
CREATE INDEX idx_stocks_last_updated ON stocks_unified(last_updated DESC);

-- Constraints de Valida√ß√£o
CONSTRAINT valid_pe_ratio CHECK (pe_ratio >= 0)
CONSTRAINT valid_market_cap CHECK (market_cap >= 0)
```

## üìö Refer√™ncias e Fontes

### üîó **APIs e Servi√ßos**
- **yfinance**: Dados hist√≥ricos, pre√ßos, dividendos, fundamentais b√°sicos
- **Perplexity AI**: Dados fundamentais verificados 2024/2025, an√°lises de mercado
- **Yahoo Finance**: Dados de mercado em tempo real

### üìñ **Metodologias**
- **GICS**: Classifica√ß√£o setorial padr√£o
- **Sharpe Ratio**: Metodologia de Sharpe (1966)
- **Max Drawdown**: An√°lise de risco padr√£o
- **ROI/ROA/ROE**: M√©tricas financeiras padronizadas

---

## üéâ Conclus√£o

A tabela `stocks_unified` representa um marco na an√°lise quantitativa de a√ß√µes americanas, combinando dados hist√≥ricos robustos com an√°lises de IA contextualizadas. Com **393 a√ß√µes de classe mundial processadas** e **6.288 campos fundamentais** preenchidos, esta base de dados oferece uma vis√£o abrangente e atualizada do mercado americano.

**√öltima Atualiza√ß√£o**: Janeiro 2025
**Pr√≥xima Atualiza√ß√£o Programada**: Trimestral
**Respons√°vel**: Sistema Automatizado de Enriquecimento de Dados

---

*Documenta√ß√£o gerada automaticamente baseada na opera√ß√£o massiva de enriquecimento de dados realizada em Janeiro 2025.*
